GSRS v1.2.07
============

Changes:

Enhancements
------------

1. Specific properties can now be added as facets
   (e.g. viscosity)
2. Password no longer required to make user
   (autogenerated)
3. Can sort on browse / search
4. Added missing CV value for relationship
5. Password no longer required on edit user
6. Show history and change reason on record view
7. Improved facet overflow handling
8. Moved Audit information to top of record, 
   collapsed by default.

Bug Fixes
---------
1. Substructure searches sometimes attempted to render
   an ID as a molecule. This is fixed now.
2. Residue lookup on edit would show all residues as invalid
   until one change happened. This is fixed now.
3. To more than one element would sometimes increase the 
   substance version twice or more, causing issues with
   retrieving null edit history.
4. Improved release strategy for Locks on records. Pervious
   Locks were released logically, but were not released
   from memory.
5. Making no change to a record, but saving it would add
   an entry to the history table, but do nothing else. 
   This caused a problem, as the software assumes that
   each version of the substance has 1 entry in the history
   table. We no longer allow making a non-change to a record.
6. Cancelling the persistence of an inverted relationship
   would persist an Edit for that attempted change, even
   though none was performed, due to a misreporting by
   the trigger. The trigger was corrected.
7. Don't fail text indexing on empty strings

Deeper look
-----------

1. We can now fetch edit history from the substance 
   directly. In fact, this can be done for all records
   using the EntityWrapper.
2. The @ChangeReason is now an annotation on a field,
   and this can be used to do certain logical operations
   during validation ins a generic way. Also, the change
   reason is now fetched from the generic object,
   and stored in the comments of the Edit object. This
   allows for quick browsing of edits.
3. The EntityFactory `updateEntity` method used to gather
   all the changed using `PojoDiff`, and then save each entity
   from top to bottom in order of finer and finer granularity.
   It should be that this is unnecessary, as `Ebean` should
   enforce cascading. However, there have been issues in the
   past where the full chain of changes were not directly
   updated, as no change was detected in the record. For example:
	Substance
		Modifications
			Structural Modifications
   If there is a change to a field on "Structural Modification", 
   but no other fields up the chain, saving "Substance" will not
   directly make an update call to the database for the Substance
   table. It may, however, trigger the saving of "Structural 
   Modifications" down the chain. But any post-update
   or pre-update hooks on "Substance" or "Modifications" won't be
   called. To get around that, we always explicitly force a change
   to happen on each element in the chain, so that a save will
   actually be performed, and the hooks will get triggered as
   expected. To do this, we have a `ForcableUpdateModel` interface
   with a method `forceUpdate` which should make some internal 
   change to the Entity (hidden field) so that an update will actually
   trigger a change. We then call this method on each entity in the
   chain. However, internally, the Ebean `Model` may also trigger
   other `update` methods to be called.

   (One possible solution is to instead have a `flagForceUpdate`
   operation, instead of actually doing both the change and the update
   in one go. That should allow us to avoid having to call several
   force updates, and we can only call the top level save, trusting
   that Ebean will do the rest. However, this remains to be tested.
   We have a few selective following of Cascade rules that have been
   tuned due to ideosynchratic behaviors of the models and ebean.)  

   A particular problem with the "forceUpdate" idea  is that the 
   hooks are sometimes called twice. This is ok from a database 
   perspective (except for the performance knock). However, if there
   is some important mutating operation in a preUpdate hook, or
   a postUpdate hook that is particularly sensitive to the changes
   since the last call (rather than being state-specific), this
   can lead to some unexpected results. Specifically here, we found
   that updating a record in a complex way would cause the Substance
   record to have its preUpdate hooks called more than once. One of
   those hooks was a procedure for incrementing the version number
   the substance. Because of this, the Substance version was double
   incremented, but only 1 entry was made in the Edit table (as
   it is saved only once after the full completion of the update).
   To fix this, we now use the record "MyLock" Lock to track whether the
   entity has had its hook methods called yet or not, to avoid
   double-calling. This does not prevent double SQL updates, but it
   does pretect against high-level double hooks. This solution
   is not perfect, as we only use a "MyLock" element for the high
   level entity that we are attempting to update. If there are 
   sensitivities in sub elements, they are not protected from
   double hooks at this time.

4. Calling "performChange" on the EntityPersistAdapter will create
   an Edit, and save it after the change is performed, as long
   as the ChangeOperation returns a non-empty Optional. The
   RelationshipProcessor accidentally returned a non-empty
   Optional in some cases where no update was done. This
   has been fixed to return a empty Optional now, but the 
   performChange method should actually be smart enough not to
   save the edit unless some save has happened within ChangeOperation.
   This could be done by moving the actual save operation out 
   of the ChangeOperation, and instead into the performChange
   method. This is related to #3 above. If the updates
   can be simplified to make a single "update" call, without
   need to deeper processing, this move should be fine.




GSRS v1.2.06
============

Changes:

Enhancements
------------
1. Improve indexing performance (Addresses GSRS-102 and GSRS-76)
2. Lazy-load search results to improve search performance
   and stability. (Addresses GSRS-102 and GSRS-76)
3. Improved search analyzer to show more accurate suggestions
   for restricting global searches. (Addresses GSRS-102 and GSRS-76)
4. Allow searching by code systems (BDNUM, CAS, etc)
5. Improved keyboard navigation for 508 compliance
6. Restrict to names or code search options (GSRS-87)
7. Improved initial browse and paging now far more robust
   and less likely to cause problems
8. Added debugging utilities for developers to add specific
   delays to database fetches and structure processing,
   to find problematic areas under stress testing.
9. A new Role "Approver" has been added. Users with this role
   can approve substances. SuperUpdater role no longer has
   approval access. Instead, SuperUpdater can now also
   update record information for previously approved
   substances. (GSRS-86)
10.Fields to be indexed for analysis have been restricted
   to a few names fields. (Addresses GSRS-102)
11.Added CodeSystem indexes to speed up validation.
12.Only load sketcher on pages that use it, to speed up
   page loads.
13.Structure searches now use cache in processing. (Addresses GSRS-102)

Bug Fixes
---------
1. Fixed structure search reloading issue. A quickly 
   returning substructure search might have the wrong
   infomation before, and not refresh when the search
   is complete. Now it refreshes when ready. (Addresses GSRS-102)
2. Reindexing previously wouldn't update autosuggest
   or sorting operations, unless the application was
   also restarted. Now the reindexing will correctly update autosuggest
   without a restart.
3. Empty modifications were being saved which would break display,
   wrapped each display with a null check.
4. In some bulk loads, the same record may have been 
   editted by different threads. In a few cases this
   was found to cause a OptimisticLockException, and
   the transaction was cancelled.  This is a problem
   when adding common inverted relationships. The 
   locking mechanism has been reorganized, and is now
   very unlikely for this to be an issue.
5. Fixed edit history bug related to #3.
6. Fixed IndexAlreadyClosedException problem, where
   the Lucene index was closed before all the
   results were fetched from the database.
7. Tags now different than Reference tags, as intended
 

GSRS v1.2.05
============

Changes:

1. Fixed caching issue ajaxing for status of request
2. Added download option to server-side for SDF
3. Restrict Approval to SuperUpdater, not updater
4. Change download to download SDF by default
5. Improved API for exporting record sets
6. Allow downloading CSV as export option via URL
7. Removed expression producing ArrayOutOfBounds 
   stacktrace exception
8. Refactored export mechanism to consume less memory
9. Fixed flex match caching issue
10. Fixed navlist on details view not scrollable
11. Fixed error page overlap
12. Hide "+" icon on text search with known results
13. Added canonicalization algorithm for mol formulas
    to approximate modified Hill System Order, 
    compatible with MDL cartridge.
14. Allow UI download of SDF and CSV for results
15. Show structure of query on flex / exact search
16. Preserve drawn structure coordinates on structure 
    query
17. Use molfile for search rather than smiles by default
    to avoid structure processing errors from drawing
    tool, which lead to improper results.
18. Fixed paging buttons to be more standardized, allow
    seeing next 2 pages on browse.
19. Make browse page labels collapsible
20. Fix tooltip locator overlap issue
21. Fix missing button in subref search
22. Force creation date to be overwritten on API submission
23. Update on the user admin page to show the top menu
24. Add navigation link for most of the response pages
25. Hide 'Edit Substance' button if user doesnt have access to edit
26. Fixed text search paging status ajax issue
27. Show more information about page loading when waiting for page


GSRS v1.2.04
============

Changes:

1. No longer require URLs in code form
2. Fix relationship type facet UI overflow
3. Refactored UI code
4. Improved audit and definition reference views
5. Allow server failures on validation to be displayed to user
6. Fixed change reason hidden bug
7. Only show change reason on substance edit
8. Improve physical parameter form
