@import ix.ginas.controllers.GinasApp;

<div class = "row info" >
    <button class="btn btn-primary label-offset det">
                      Relationships&nbsp;<span class="badge" ng-show="substance.relationships.length>0">
                        {{substance.relationships.length}}</span> </button>
    @*<a ng-show="!addingStructure" ng-click="addStructure()" aria-label="Add Structure"><i class = "fa fa-plus fa-2x success"></i></a>*@
    @*<div ng-show="addingStructure">*@
    <div class="col-md-12">

        <div class ="row header-row">
            <div class="col-md-2"><strong>Related Substance</strong></div>
            <div class="col-md-2"><strong>Type</strong></div>
            <div class="col-md-2"><strong>Comments</strong></div>
            <div class="col-md-2"><strong>Interaction Type</strong></div>
            <div class="col-md-2"><strong>Qualification</strong></div>
            <div class="col-md-1"><strong>Amount</strong></div>
            <div class="col-md-1"><strong>Reference ID</strong></div>

        </div>
        <div ng-repeat="relationship in substance.relationships">
                    <div class="row">
                        <div class ="col-md-2">
                           <substance-chooser ng-model="relationship.relatedSubstance"></substance-chooser>
                        </div>
                       <div class = "col-md-2">
                           <span href="#" editable-select="relationship.type"  e-style="width: 100%" e-ng-options="r.display for r in lookup.getList('RELATIONSHIP_TYPE') track by r.display" blur="submit">{{relationship.type.display}}</span>
                       </div>
                       <div class="col-md-2">
                       <span href="#" editable-text="relationship.comments" blur="submit">{{relationship.comments}}</span>
                   </div>
                       <div class = "col-md-2">
                           <span href="#" editable-select="relationship.interactionType"  e-style="width: 100%" e-ng-options="r.display for r in lookup.getList('INTERACTION_TYPE') track by r.display" blur="submit">{{relationship.interactionType.display}}</span>
                       </div>
                       <div class = "col-md-2">
                           <span href="#" editable-select="relationship.qualification"  e-style="width: 100%" e-ng-options="r.display for r in lookup.getList('QUALIFICATION') track by r.display" blur="submit">{{relationship.qualification.display}}</span>
                       </div>
                        <div class="col-md-1">
                        <amount value = "relationship.amount"></amount>

                        </div>
                        <div class="col-md-1">
                       @referenceview("relationshipForm", "relationship")
                            </div>
                       </div>
        </div>


        <form class="form-horizontal" name="relationshipForm" id = "add-relationship" role="form" novalidate>
            <div class="row form-row">
                <div class="col-md-2">
                <substance-chooser ng-model="relationship.relatedSubstance"></substance-chooser>

                </div>
                <div class="col-md-2 err-check" show-errors>
                    <select class="form-control" title="Relationship Type" id="type" name = "type" ng-model = "relationship.type" ng-options="r.display for r in lookup.getList('RELATIONSHIP_TYPE') track by r.display" required>
                        </select>
                    <ng-messages for="relationshipForm.type.$error" ng-if="relationshipForm.type.$touched">
                        <ng-message when="required" class="help-block">*required</ng-message>
                    </ng-messages>
                </div>
                <div class="col-md-2" id="ref-div">
                    <input type="text" class="form-control" ng-model ="relationship.comments" title="Comments" id="comments" name = "comments" />
                </div>

                <div class="col-md-2 err-check" show-errors>
                    <select class="form-control" title="Interaction Type" id="interactionType" name = "interactionType" ng-model = "relationship.interactionType" ng-options="r.display for r in lookup.getList('INTERACTION_TYPE') track by r.display" required>
                        </select>
                    <ng-messages for="relationshipForm.interactionType.$error" ng-if="relationshipForm.interactionType.$touched">
                        <ng-message when="required" class="help-block">*required</ng-message>
                    </ng-messages>
                </div>
                <div class="col-md-2 err-check" show-errors>
                    <select class="form-control" title="Qualification" id="qualification" name = "qualification" ng-model = "relationship.qualification" ng-options="r.display for r in lookup.getList('QUALIFICATION') track by r.display" required>
                        </select>
                    <ng-messages for="relationshipForm.qualification.$error" ng-if="relationshipForm.qualification.$touched">
                        <ng-message when="required" class="help-block">*required</ng-message>
                    </ng-messages>
                </div>
                <amount-edit-display ng-model="relationship.amount"></amount-edit-display>                
                <reference-selector ngModel='relationship' references='substance.references'></reference-selector> 
            </div>
            <amount-form ng-model="relationship.amount"></amount-form>
            <submit-buttons submit="relationship" form="relationshipForm" path="relationships"></submit-buttons>
        </form>

    </div>
</div>